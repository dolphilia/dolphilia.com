# 新しいリリースへのアップグレード

::: info

Mastodon の新しいバージョンが出ると、[GitHub リリースページ](https://github.com/mastodon/mastodon/releases) に表示されます。未リリースのコードを `master` ブランチから実行することは可能ですが、推奨されませんのでご注意ください。

:::

Mastodon のリリースは git タグに対応しています。アップグレードを試みる前に、[GitHub リリースページ](https://github.com/mastodon/mastodon/releases) で希望するリリースを調べてください。このページには、**変更点** と、**アップグレードの具体的な手順** が記述されています。

まず、ユーザーを `mastodon` に変更します。

```bash
su - mastodon
```

そして、Mastodonのルートディレクトリに移動してください。

```bash
cd /home/mastodon/live
```

バージョンは `v3.1.2` と仮定して、リリースのコードをダウンロードします。

```bash
git fetch --tags
git checkout v3.1.2
```

ここで、GitHub上のそのバージョンのリリースノートに記載されているアップグレード手順を実行します。リリースによって必要な手順が異なるため、このページには手順を記載していません。

::: info

古いバージョンからアップグレードする場合、中間リリースをスキップすることができます。個別にチェックアウトする必要はありません。しかし、各リリースの手順を追跡する必要はあります。ほとんどの指示は重複しているので、少なくとも一度はすべてを実行することを確認する必要があります。

:::

リリースノートにある手順を実行した後、rootに戻ります。

```bash
exit
```

**バックグラウンドワーカー**を再起動します。

```bash
systemctl restart mastodon-sidekiq
```

そして、**Webプロセス**を再読み込みします。

```bash
systemctl reload mastodon-web
```

::: info

`reload` 操作はダウンタイムなしの再起動で、「段階的な再起動」とも呼ばれます。そのため、Mastodon のアップグレードでは、通常、ユーザにダウンタイムについて事前に通知する必要はありません。まれに `restart` オペレーションを代わりに使うこともできますが、その場合、ユーザーに対して（短期間の）サービスの中断を感じることになります。

:::

まれに、**streaming API**サーバーも更新され、再起動が必要になることがあります。

```bash
systemctl restart mastodon-streaming
```

::: warning

Streaming APIサーバーの更新は非常に稀であり、ほとんどのリリースでは再起動は必要ありません。Streaming APIを再起動すると、切断されたクライアントが再接続を試みたり、REST APIをポーリングしたりするため、サーバーへの負荷が増加します。

:::

::: tip

**以上です！** あなたは今、Mastodonの新しいバージョンを実行しています。

:::
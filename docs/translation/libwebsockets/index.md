# Libwebsockets

## 概要

Libwebsocket (LWS) は、ノンブロッキングイベントループを利用して、最新のネットワークプロトコルを小さなフットプリントで簡単に実装できる、柔軟で軽量のピュアCライブラリです。2010年から継続的に開発され、世界中の数千万台のデバイスと数千人の開発者によって利用されています。

LWSは、MITライセンスによるフリーソフトウェアです。

## はじめに

```sh
git clone https://libwebsockets.org/repo/libwebsockets
```

- Browse git: v4.3, main.
- 80 minimal examples: v4.3, main.
- Doxygen API docs: v4.3, main.
- Demo server: Simple demo server

## LWSの役割

LWSのコアコードは、一般的なソケットのライフサイクル、tls、vhosts、サービススレッド、タイマー、unixドメインソケット、SOCKS5などを処理する。「ロール」は、その上のワイヤープロトコルの実装で、ops構造体を介して分離されています。

|         Role         | Client | Server |
| -------------------- | ------ | ------ |
| http/1.x             | ⭘      | ⭘      |
| http/2               | ⭘      | ⭘      |
| websockets           | ⭘      | ⭘      |
| ws-over-h2           | ⨯      | ⭘      |
| raw tcp / udp / file | ⭘      | ⭘      |
| MQTT                 | ⭘      | ⨯      |

LWSは、どのロールでもクライアントまたはサーバー（クライアントの証明書を含む）のオプションのTLSをサポートしています。

新しいロールは lws にきれいに追加することができます。

## TLS(SSL)対応

LWSはOpenSSLベースのTLSバックエンドライブラリとmbedTLSのTLSバックエンドライブラリを等しくサポートします。OpenSSLは高速ですが、より多くのメモリを必要とします。制約のあるデバイスでは、TLSバックエンドにmbedTLSを選択することで、速度とメモリフットプリントをトレードオフにすることができます。

LWSは、ハッシュ、RSA、X509、tlsバックエンドに依存しないtlsライブラリ機能にアクセスするための汎用的なAPIを提供します。

## LWSプロトコル

ユーザーコードは、カスタマイズに興味のあるイベントのコールバックを含む「プロトコル」を提供することで、LWSのロールにインターフェースしています。

## イベントループライブラリ

LWS はデフォルトで poll() を使用しますが、glib, libuv, libevent, libev イベントライブラリはすべてサポートされています。LWSは内部ループを提供することも、外部の "外部 "ループに参加することもできます。新しいイベントライブラリは lws にきれいに追加することができます。

LWS のユーザコードは、使用するイベントループによってカスタマイズする必要はありません。例えば、LWS は、選択されたイベントループに依存する正確な実装の詳細を隠して、遅延コールバックを手配するために、各接続のための汎用高解像度タイマーを提供します。

## プラットフォーム

LWSは、LinuxやBSD（Macを含む）などのUnix系プラットフォームはもちろん、Windowsや、ESP32、FreeRTOSでも利用可能です。

CMakeはビルドするプラットフォームに合わせてソースを構成するために使用され、クロスビルドもサポートされています。

## スケーラビリティ

LWSはシングルスレッドのノンブロッキングイベントループを使用しますが、これをn個のスレッドで持ち、最もビジーでないサービススレッドに接続を割り当てることでスレッド間の接続を分散し、1インスタンスで数十万接続までのスケーラビリティを提供することもサポートされています。

## QA

LWSは、Travis（Linux/gccとMac/clang）とAppveyor（Windows）の両方を使用して、-Wallと-Werror、さらにgccのオプション診断を使用して40種類の設定を構築-テストしています。

ビルドに成功すると、httpパーサーのセキュリティや堅牢性、OpenSSLやmbedTLSのような特定の目標に対して、Autobahn, h2spec, h2load, lwsスイートに対して1500のテストが実行されます。問題があれば、CIビルドは中断されます。

## サポート

最小限の例とドキュメントに目を通してください。

それからメーリングリスト